<?php
// $Id$

/**
 * @file
 * Displays RBSC Special Collections Research Account block, with link set by admin
 */


/**
 * Implements hook_init().
 *
 */
function research_account_block_init() {
	// nothing needed here
}

/**
 * Implements hook_permission().
 *
 */
function research_account_block_permission() {
  return array(
    'administer research_account_block' => array(
      'title' => t('Administer Research Account Block module'),
      'description' => t('Perform administration tasks for Research Account Block module.'),
    ),
    'access research_account_block blocks' => array(
      'title' => t('Access Research Account blocks'),
      'description' => t('View blocks generated by the Research Account Blocks module.'),
    ),
  );
}

/**
 * Implements hook_block_info().
 *
 */
function research_account_block_block_info() {
  $blocks['research_account_block'] = array(
    'info' => t('Research Account Login'),
    'cache' => DRUPAL_CACHE_PER_ROLE,
  );
  return $blocks;
}

/**
 * Implements hook_block_configure().
 *
 */
function research_account_block_block_configure($delta = '') {

  $form['research_account_block_link'] = array(
    '#type' => 'textfield',
    '#title' => t('Link to Research Account Login/Register'),
    '#default_value' => variable_get('research_account_block_link', 'https://libweb10.princeton.edu/aeon/'),
    '#size' => 60,
    '#description' => t('This link will appear as a button in the Research Account block.'),
  );
  return $form;
}

/**
 * Implements hook_block_save().
 *
 * Learn more about hook_block_save() here:
 * http://api.drupal.org/api/drupal/modules--block--block.api.php/function/hook_block_save/7
 */
function research_account_block_block_save($delta = '', $edit = array()) {
  variable_set('research_account_block_link', $edit['research_account_block_link']);
}

/**
 * Implements hook_block_view().
 *
 * Generates block to display Research Account Link.
 *
 */
function research_account_block_block_view($delta = '') {
  if (user_access('access research_account_block blocks')) {
    $block = array();
    $type = $delta;
    
    switch ($delta) { 
      case 'research_account_block':
        // Link to the Special Collections Research Account.

        // Grab the research account link from a variable
        $link = variable_get('research_account_block_link', array());

        // Output the link as a button
        $output = ''; // Initialize variable
        
        // <a href="#" class="btn btn-primary btn-lg active" role="button">Primary link</a>
	      $output = '
	        <a href="' . $link . '" class="btn btn-primary btn-lg active" role="button">Login</a>
	      ';


        // Prepare to return the $block variable with subject (title) and content (output).
        $block['subject'] = 'Research Account';
        $block['content'] = $output;
        break;
    }

    return $block;
  }
}
